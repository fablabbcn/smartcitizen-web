<!-- TODO add validation -->
<button
  name=csvFiles
  type="file"
  class="md-button btn-blue md-flat"
  ngf-select="vm.change($files, $invalidFiles)"
  ngf-before-model-change="vm.onSelect()"
  ngf-multiple="true"
  ngf-accept="'application/csv,.csv'"
  ngf-max-files="30"
  ngf-max-size="'10MB'"
  ngf-pattern="'.csv'">
  Load CSV Files
</button>

<div class="">
  <h3>Upload your files</h2>
  <p>Selec the files you want and upload them into your kit!</p>
</div>

<md-input-container>
  <label>Actions</label>
  <md-select ng-model="vm.action">
    <md-option ng-value="null"><em>None</em></md-option>
    <md-option value="selectAll" ng-disabled="vm.haveSelectedAllFiles()">
      Select all
    </md-option>
    <md-option value="deselectAll" ng-disabled="vm.haveSelectedNoFiles()">
      Deselect all
    </md-option>
    <md-option value="upload" ng-disabled="!vm.haveSelectedFiles()">
      Upload
    </md-option>
    <md-option value="remove" ng-disabled="!vm.haveSelectedFiles()">
      Remove
    </md-option>
  </md-select>
</md-input-container>


<md-button class="md-flat" ng-class="vm.action ? 'md-primary' : 'md-default'" ng-click="vm.doAction()" ng-disabled="(!vm.csvFiles || vm.csvFiles.length === 0) && !vm.action">
  Apply
</md-button>

<md-progress-linear md-mode="{{ vm.loadingType }}" ng-value="vm.loadingProgress" ng-if="vm.loadingStatus"></md-progress-linear>

<md-card class="bg-yellow" ng-if="vm.invalidFiles && vm.invalidFiles.length > 0">
  <md-card-content>
    <md-list>
      <md-list-item ng-repeat="invalidFile in vm.invalidFiles">
        <div ng-messages="invalidFile.$errorMessages">
          <div ng-message="pattern">
            {{invalidFile.name}} is not a CSV file
          </div>
          <div ng-message="maxSize">
            {{invalidFile.name}} is too large ({{ invalidFile.size / 1000000 | number:1 }}MB)
          </div>
          <div ng-message="maxFiles">
            You can only load 30 files at a time: {{invalidFile.name}} has not been added
          </div>
          <div ng-message="duplicate">
            {{invalidFile.name}} is already on the list
          </div>
        </div>
      </md-list-item>
    </md-list>
  </md-card-content>
  <md-card-actions layout="row" layout-align="end center">
    <md-button ng-click="vm.invalidFiles = null" class="md-warn" >
      close
    </md-button>
  </md-card-actions>
</md-card>

<md-list ng-if="vm.csvFiles && vm.csvFiles.length > 0" class="list-shadow">
  <md-list-item ng-class="{'bg-green':csvFile.success}" ng-repeat="csvFile in vm.csvFiles" class="md-2-line">
    <div class="md-list-item-text" layout="column">
      <div class="csv_file_item">
        <md-checkbox ng-model="csvFile.checked" ng-disabled="csvFile.success"></md-checkbox>
        <span>{{csvFile.name}}</span>
        <md-button ng-click="csvFile.detailShowed = !csvFile.detailShowed" ng-if="(csvFile.parseErrors || csvFile.backEndErrors) && !csvFile.success" class="md-icon-button md-warn">
          <md-tooltip md-direction="top">Show details</md-tooltip>
          <md-icon md-svg-icon="./assets/images/alert_icon.svg"></md-icon>
        </md-button>
        <md-progress-circular ng-if="csvFile.progress" md-mode="indeterminate" md-diameter="20"></md-progress-circular>
        <span flex></span>
        <span ng-if="csvFile.isNew && !csvFile.success" class="label">new data</span>
        <md-button ng-click="vm.removeFile($index)" class="md-icon-button md-default" >
          <md-icon md-svg-icon="./assets/images/delete_icon.svg"></md-icon>
        </md-button>
      </div>

      <md-card class="bg-yellow" ng-if="csvFile.detailShowed">
        <md-card-content>
          <md-list>
            <md-list-item ng-repeat="error in csvFile.parseErrors">
              {{error.message}} <span ng-if="error.row">(at row: {{error.row}})</span>
            </md-list-item>
            <md-list-item ng-if="csvFile.backEndErrors">
              {{csvFile.backEndErrors.statusText || csvFile.backEndErrors}} {{csvFile.backEndErrors.status}}
              <span ng-if="csvFile.backEndErrors.data"></span>: {{ csvFile.backEndErrors.data.message || csvFile.backEndErrors.data.errors }}
            </md-list-item>
          </md-list>
        </md-card-content>
      </md-card>
    </div>
  </md-list-item>
</md-list>

<md-list ng-if="!vm.csvFiles || vm.csvFiles.length === 0" class="list-shadow">
  <md-list-item>
    <div class="md-list-item-text" layout="column">
      There are no files in here. Letâ€™s upload something!
    </div>
  </md-list-item>
</md-list>
